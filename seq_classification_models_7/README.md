## seq_classification_models_7
اصلاح شده کد فایل sentiment_analysis_model_6 : رفع خطا ها ، ماژولار کردن کد

لینک فایل sentiment_analysis_model_6:  
https://github.com/YasJanam/NLP_MODELS_2/tree/main/sentiment_analysis_model_6
### توضیح کلی
این کد پیاده سازی چند تا attention و FFN هستش که عملکردشون روی سه دیتاست بررسی میشه.  
ساختار کد ماژولار هست، یعنی هر چقدر بخاین میتونین Attention , ffn تعریف کنید، به راحتی از طریق کلاس CustomTransformer سرِ هم میشن و یک ترنسفورمر جدید دارید.  
همچنین با هر لیست دلخواهی از ترنسفورمر ها از طریق کلاس Model میشه یک مدل درست کرد. کافیه لیست ترنسفورمر ها رو موقع تعریف مدل، ورودی init بدید.  
البته نیازی نیست دستی لیست ترنسفورمر ها رو بسازید چون با کلاس Create_Module_list این کار رو میشه انجام داد، فقط باید یک لیستی از تاپل ها ورودی بهش داد، هر تاپل این لیست یک زوج **(attention, ffn)** هستش.     
در واقع مولفه های این تاپل فقط **اسم کلاس** هستند نه نمونه های تعریف شده از کلاس، یعنی تنها اسم کلاس رو بنویسید، لازم نیست بیاین یک نمونه تعریف کنید و اون نمونه رو مولفه تاپل قرار بدید.  
کلاس Create_Module_list با کلاس های attention , ffn موجود در تاپل یک ترنسفورمر میسازه و به این ترتیب وقتی برای لیستی از تاپل ها اینکار رو بکنه در نهایت لیستی از ترنسفورمر ها میسازه و خروجی برمیگردونه. اون لیستو میشه ورودی مدل داد!  
در ضمن این کارها (دادن لیست تاپل به کلاس Create_Module_list و دادن خروجی اش به کلاس Model) توی متد Train-Method انجام شده، تنها کاری که باید کرد اینه که لیست تاپل ها رو ورودی متد بدید.   
همچنین اگه یک تاپل فقط یک مولفه اش مشخص باشه و مولفه دیگه اش None باشه هم مشکلی پیش نمیاد چون در این صورت خود کلاس مولفه های ترنسفورمر استاندارد رو جایگزین میکنه.  
مورد دیگه ای که هست اینه که اگه میخاین فقط یک ترنسفورمر رو چند بار تکرار کنید نیازی نیست که تاپل مربوط بهش رو چند بار بنویسید، ارگومانی هست به اسم **num_repeats** که به اندازه اش تاپل ها تکرار میشن.

### دیتاست ها
سه دیتاست استفاده شده :
یک دیتاست ۲۰ کلاسه ، sst5 , imdb. 

لینک دیتاست ۲۰ کلاسه :
https://github.com/YasJanam/NLP_MODELS_2/tree/main/sentiment_analysis_model_6/dataset(20_classes)  

موارد مربوط به لود و پیش پردازش دیتاست ها در کد قابل مشاهده و واضح هست؛ فقط یک مورد مهم که در کد قبلی رعایت نشده بود ولی اینجا رعایت شده، طول max_length در پیش پردازش دیتاست ها هست.  
برای هر دیتاست max_length حدودا برابر percentile ۹۹ طول متن های دیتاست درنظر گرفته شده. این خیلی بهتر از وقتی بود که کلا یک عددی (مثلا ۶۱۲ یا ۱۰۲۴ یا هر چی) رو همینجوری برابر max_length میزاشتیم.  
چرا؟ چون مثلا اگه حداکثر طول تکست یک دیتاست ۹۳ باشه و ما max_length در پیش پردازش رو ۵۱۲ میزاشتیم ببینید چقدر از هر متن توکنایز شده پد میشه!!! عملا مدل پد های padding رو یاد میگیره! 
### LitModule
این کلاس برای مدیریت trrain مدل هست. دقت کلی و دقت هر کلاس دیتاست در مرحله تست گزارش میشه.  همچنین خطایی که در RL_scheduler در کد قبلی بود اصلاح شد.
### InitWeight
این کلاس یک کلاس callable هست. کاربردش مقدادهی اولیه وزن های لایه هایgru, lstm,linear,con1d هستش. کافیه در هر کلاس apply بشه.
### کلاس های attention
چند تا کلاس attention تعریف شده که در اونها به جای لایه های linear از لایه های دیگه مثلا gru , con1d استفاده شده. 
### کلاس های FFN
چند کلاس FFN هم تعریف کردیم تا به عنوان قسمت feedforward ترنسفورمر ها ازشون استفاده کنیم.
در کل اگه ffn تا حدودی ساده باشه و از لایه های خطی درست بشه بهتره.  
یک ffn پر استفاده و کاربردی با دولایه linear و یک relu بینشون ساخته شده. به جای relu بعضی جاها gelu هم میزارن. این متد های relu , gelu برای این گذاشته میشه که کمی رفتار کاملا خطی ffn غیر خطی بشه. 
### CustomTransformer
این کلاس برای اینه که با هر بلاک attention و هر بلاک ffnای یک ترنسفورمر بسازیم. کافیه attention و ffn ورودی بهش داده بشوند.  
همچنین تکنیک residual هم پیاده شده.(که البته باید میشد)  
توجه کنید که اگه بلاک های attn , ffn بهش ورودی داده نشن به جاش از attention ,feedforward ترنسفورمر استاندارد برای ساخت ترنسفورمر استفاده میشه.(در واقع ترنسفورمر استاندارد ساخته میشه)
### Model
این کلاس برای ساخت مدل با هر لیستی از ترنسفورمر ها استفاده میشه.هر ترنسفورمر هایی که نیاز هست رو در قالب یک لیست ورودی مدل بدید تا مدل مورد نظر ساخته بشه.
### Creat_Module_List
کلاسی برای ساخت یک لیست از ترنسفورمر ها.  
توجه کنید که اگر بخواهیم برای ساخت یک مدل، لیستی از ترنسفورمر ها تهیه کنیم باید هر ترنسفورمر رو با attn,ffn مورد نظر تعریف کنیم و به لیست اضافه کنیم. ولی این کار برای هر مدل ممکنه خسته کننده باشه.  
کلاس Creat_Module_List یک لیست از ترنسفورمر ها رو میسازه و خروجی بر میگردونه.برای ساخت ترنسفورمر ها فقط کافیه ورودی کلاسهای attn , ffn موردنظر رو در قالب لیست تاپل ها بهش پاس بدیم. ( توجه کنید که نمیخاد از کلاسهای attn , ffn نمونه تعریف کنیم و اون نمونه ها رو ورودی به کلاس بدیم، فقط باید اسم کلاسو بدیم.در کد متوجه منظور میشید)
### Train-Method
این متد خیلی کار ساخت مدل و آموزش اونو راحت میکنه.  
لیستی از تاپل های attn,ffn رو میگیره؛ با کمکCreat_Module_List یک لیست از ترنسفورمر ها میسازه، اون لیست ترنسفورمر ها رو به کلاس Model پاس میده و یک مدل میسازه، اون مدل رو به کلاس LitModule پاس میده و آموزش رو انجام میده.  
هایپرپارامترهای مدل و لیست تاپل ها و همچنین دیتاست ورودی این متد هستند.  
میشه روی هر دیتاستی با تعیین هایپرپارامترهای صحیح آموزش و تست مدل رو انجام داد.
